# 3. Node.js Backend Integration

Aprender a integrar Node.js en entornos backend implica entender sus diferencias como runtime, desarrollar APIs, conectarse a bases de datos, implementar autenticación, usar middleware y escalar la aplicación.

## 1. Runtime Differences

Node.js usa **V8** y un **event loop** no bloqueante, distinto a runtimes como Python o PHP.

- **Single-threaded** con I/O asíncrono.
- Ideal para aplicaciones en tiempo real y APIs con muchas conexiones concurrentes.

**Ejemplo de asincronía:**

```javascript
console.log("Inicio");
setTimeout(() => console.log("Tarea asíncrona"), 0);
console.log("Fin");
```

Salida:

```
Inicio
Fin
Tarea asíncrona
```

## 2. Server-Side Rendering (SSR)

Renderizar HTML desde el servidor para mejorar SEO y rendimiento. Ejemplo con **Next.js**:

```javascript
export async function getServerSideProps() {
  return { props: { time: new Date().toISOString() } };
}
```

## 3. API Development

Node.js se usa ampliamente para crear APIs REST o GraphQL.

**Ejemplo básico con Express (REST):**

```javascript
import express from "express";
const app = express();

app.get("/api/saludo", (req, res) => {
  res.json({ mensaje: "Hola desde el backend" });
});

app.listen(3000);
```

## 4. Database Integration

Conectar Node.js a bases de datos SQL o NoSQL.

**Ejemplo con MongoDB (Mongoose):**

```javascript
import mongoose from "mongoose";
await mongoose.connect("mongodb://localhost:27017/miapp");
const Usuario = mongoose.model("Usuario", { nombre: String });
await Usuario.create({ nombre: "Nico" });
```

**Ejemplo con PostgreSQL (node-postgres):**

```javascript
import { Client } from "pg";
const client = new Client();
await client.connect();
const res = await client.query("SELECT NOW()");
console.log(res.rows);
```

## 5. Authentication

Controlar acceso de usuarios con sesiones o JWT.

**Ejemplo con JWT:**

```javascript
import jwt from "jsonwebtoken";
const token = jwt.sign({ userId: 1 }, "secreto", { expiresIn: "1h" });
const datos = jwt.verify(token, "secreto");
```

## 6. Middleware

Funciones que interceptan peticiones antes de llegar al controlador.

**Ejemplo de middleware en Express:**

```javascript
function logger(req, res, next) {
  console.log(`${req.method} ${req.url}`);
  next();
}
app.use(logger);
```

## 7. Scaling

Node.js puede escalar horizontalmente usando **clustering** o balanceadores de carga.

**Ejemplo con cluster:**

```javascript
import cluster from "cluster";
import os from "os";

if (cluster.isPrimary) {
  os.cpus().forEach(() => cluster.fork());
} else {
  import("./server.js");
}
```

## 8. Microservices

Dividir el backend en servicios pequeños que se comunican vía HTTP o mensajería (RabbitMQ, Kafka).

**Ejemplo básico de microservicio:**
