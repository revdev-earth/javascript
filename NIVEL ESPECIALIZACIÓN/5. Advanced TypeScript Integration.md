# 5. Advanced TypeScript Integration

Dominar TypeScript no es solo "poner tipos a todo", sino **usar su sistema de tipos como un motor de validaci√≥n y autocompletado inteligente** que reduce errores en tiempo de ejecuci√≥n.

## 1. Type System Mastery

El sistema de tipos de TS permite crear desde simples anotaciones hasta modelos de datos complejos con inferencia autom√°tica.

**Inferencia y anotaci√≥n:**

```typescript
let mensaje = "Hola"; // inferido como string
let edad: number = 25; // expl√≠cito
```

**Tipos compuestos (union e intersection):**

```typescript
type Usuario = { nombre: string };
type Admin = Usuario & { permisos: string[] }; // intersection

let user: Usuario | Admin; // union
```

## 2. Generics

Los **gen√©ricos** permiten escribir funciones y clases reutilizables sin perder tipado.

```typescript
function envolver<T>(valor: T): T[] {
  return [valor];
}

const numeros = envolver(42); // T = number
const textos = envolver("Hola"); // T = string
```

**En clases:**

```typescript
class Caja<T> {
  constructor(public contenido: T) {}
}

const cajaString = new Caja<string>("Mensaje");
```

## 3. Utility Types

TypeScript incluye tipos utilitarios listos para usar:

| Utility       | Descripci√≥n                     | Ejemplo                   |
| ------------- | ------------------------------- | ------------------------- |
| `Partial<T>`  | Todas las props opcionales      | `Partial<Usuario>`        |
| `Readonly<T>` | Todas las props de solo lectura | `Readonly<Usuario>`       |
| `Pick<T,K>`   | Selecciona ciertas props        | `Pick<Usuario, "nombre">` |
| `Omit<T,K>`   | Elimina ciertas props           | `Omit<Usuario, "nombre">` |

```typescript
interface Usuario {
  id: number;
  nombre: string;
  email: string;
}

type UsuarioEditable = Partial<Usuario>;
```

## 4. Declaration Files (.d.ts)

Sirven para **tipar librer√≠as JS sin soporte oficial de TS**.

Ejemplo `miLib.d.ts`:

```typescript
declare module "mi-lib" {
  export function saludar(nombre: string): string;
}
```

Ahora puedes:

```typescript
import { saludar } from "mi-lib";
saludar("Nico");
```

## 5. Module Augmentation

Permite **extender** m√≥dulos existentes.

```typescript
// augment.d.ts
declare module "express" {
  interface Request {
    usuarioId?: number;
  }
}
```

Esto agrega `req.usuarioId` a la Request de Express sin modificar la librer√≠a.

## 6. Compiler API

La **Compiler API** de TS permite analizar y transformar c√≥digo de forma program√°tica.

**Ejemplo m√≠nimo para extraer nombres de variables:**

```typescript
import ts from "typescript";

const codigo = "let a = 1; let b = 2;";
const sourceFile = ts.createSourceFile(
  "test.ts",
  codigo,
  ts.ScriptTarget.Latest
);

ts.forEachChild(sourceFile, (node) => {
  if (ts.isVariableStatement(node)) {
    node.declarationList.declarations.forEach((decl) => {
      console.log((decl.name as ts.Identifier).text);
    });
  }
});
```

## 7. Migration Strategies

Migrar de JS a TS requiere orden:

1. **Inicializar proyecto:**

   ```bash
   tsc --init
   ```

2. **Renombrar archivos** `.js` ‚Üí `.ts`.

3. **Agregar** `allowJs` y `checkJs` para una migraci√≥n gradual.

4. **Tipar los puntos cr√≠ticos primero** (APIs, modelos de datos).

5. **Usar** `any` temporalmente y refinar despu√©s.

üí° **Tip experto:** Cuando usas TypeScript en serio, piensas en el dise√±o del sistema de tipos **antes** de escribir la implementaci√≥n. Esto reduce el acoplamiento y mejora la mantenibilidad.
