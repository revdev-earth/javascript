<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üîë Sistema de Autenticaci√≥n</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    h2 { color: #444; }
    form { margin-bottom: 20px; }
    input { display: block; margin: 8px 0; padding: 6px; width: 100%; }
    button { padding: 6px 12px; margin-top: 8px; cursor: pointer; }
    #estado { font-weight: bold; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>üîê Registro</h2>
  <form id="formRegistro">
    <input type="text" id="regUsuario" placeholder="Usuario" required>
    <input type="password" id="regPass" placeholder="Contrase√±a" required>
    <button type="submit">Registrar</button>
  </form>

  <h2>üîë Login</h2>
  <form id="formLogin">
    <input type="text" id="loginUsuario" placeholder="Usuario" required>
    <input type="password" id="loginPass" placeholder="Contrase√±a" required>
    <button type="submit">Iniciar Sesi√≥n</button>
  </form>

  <p id="estado">Estado: esperando acci√≥n...</p>

  <script>
    // === Closure para mantener contrase√±as privadas ===
    function crearAuthSystem() {
      const usuarios = {}; // {usuario: contrase√±a}

      return {
        registrar: (usuario, pass) => {
          if (usuarios[usuario]) {
            throw new Error("‚ö†Ô∏è Usuario ya registrado");
          }
          usuarios[usuario] = pass;
          return "‚úÖ Usuario registrado con √©xito";
        },
        login: async (usuario, pass) => {
          // simulaci√≥n asincr√≥nica de base de datos
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              if (!usuarios[usuario]) {
                reject(new Error("‚ö†Ô∏è Usuario no encontrado"));
              } else if (usuarios[usuario] !== pass) {
                reject(new Error("‚ùå Contrase√±a incorrecta"));
              } else {
                resolve("‚úÖ Login exitoso, bienvenido " + usuario);
              }
            }, 1000);
          });
        }
      };
    }

    // Crear instancia del sistema de autenticaci√≥n
    const auth = crearAuthSystem();

    // DOM
    const estado = document.getElementById("estado");
    const formRegistro = document.getElementById("formRegistro");
    const formLogin = document.getElementById("formLogin");

    // Evento de registro
    formRegistro.addEventListener("submit", (e) => {
      e.preventDefault();
      const usuario = document.getElementById("regUsuario").value.trim();
      const pass = document.getElementById("regPass").value.trim();

      try {
        const msg = auth.registrar(usuario, pass);
        estado.textContent = "Estado: " + msg;
      } catch (err) {
        estado.textContent = "Error: " + err.message;
      }
    });

    // Evento de login
    formLogin.addEventListener("submit", async (e) => {
      e.preventDefault();
      const usuario = document.getElementById("loginUsuario").value.trim();
      const pass = document.getElementById("loginPass").value.trim();

      try {
        estado.textContent = "‚è≥ Validando credenciales...";
        const msg = await auth.login(usuario, pass);
        estado.textContent = "Estado: " + msg;
      } catch (err) {
        estado.textContent = "Error: " + err.message;
      }
    });

    // === Testing b√°sico ===
    console.log("=== TESTS ===");
    try {
      console.log(auth.registrar("nico", "1234")); // registrar usuario
    } catch (e) { console.error(e.message); }
    auth.login("nico", "1234").then(console.log).catch(console.error); // login correcto
    auth.login("nico", "0000").then(console.log).catch(console.error); // login incorrecto
  </script>
</body>
</html>
