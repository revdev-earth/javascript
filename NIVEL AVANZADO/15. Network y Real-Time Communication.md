# 15. Network y Real-Time Communication

La comunicaci√≥n en la web abarca desde solicitudes HTTP simples hasta transmisi√≥n de datos en tiempo real. Cada tecnolog√≠a ofrece distintas capacidades, y saber cu√°ndo usar cada una es clave para optimizar rendimiento y experiencia de usuario.

## 1. XMLHttpRequest (XHR)

API antigua para hacer solicitudes HTTP desde JavaScript.

- Soporta asincron√≠a y seguimiento del progreso.
- Sintaxis m√°s verbosa que fetch, pero a√∫n usada en librer√≠as como Axios.

```javascript
const xhr = new XMLHttpRequest();
xhr.open("GET", "/api/data");
xhr.onload = () => console.log(xhr.responseText);
xhr.onerror = () => console.error("Error en la solicitud");
xhr.send();
```

üí° **Uso actual:** soporte en navegadores antiguos, casos donde se necesite control granular de progreso (subida/descarga).

## 2. Fetch API

Reemplazo moderno de XHR.

- Basado en promesas.
- M√°s limpio y compatible con async/await.

```javascript
fetch("/api/data")
  .then((res) => res.json())
  .then((data) => console.log(data))
  .catch((err) => console.error(err));

// Con async/await
async function loadData() {
  try {
    const res = await fetch("/api/data");
    const data = await res.json();
    console.log(data);
  } catch (e) {
    console.error(e);
  }
}
```

üí° **Uso t√≠pico:** cualquier solicitud HTTP moderna.

## 3. WebSockets

Canal de comunicaci√≥n bidireccional y persistente.

- Ideal para aplicaciones en tiempo real (chat, videojuegos, trading).
- Funciona sobre un solo socket TCP.

```javascript
const socket = new WebSocket("wss://example.com/socket");

socket.onopen = () => socket.send("Hola servidor");
socket.onmessage = (event) => console.log("Mensaje:", event.data);
```

üí° **Uso t√≠pico:** chat en vivo, paneles de control, colaboraciones en tiempo real.

## 4. Server-Sent Events (SSE)

Comunicaci√≥n unidireccional del servidor al cliente.

- Basado en HTTP y m√°s ligero que WebSockets para actualizaciones unidireccionales.

```javascript
const evtSource = new EventSource("/events");
evtSource.onmessage = (e) => console.log("Evento:", e.data);
```

üí° **Uso t√≠pico:** notificaciones en vivo, feeds de datos, actualizaciones autom√°ticas.

## 5. WebRTC

Comunicaci√≥n P2P (peer-to-peer) en tiempo real.

- Soporta audio, video y datos.
- Usado en videollamadas, transmisi√≥n multimedia y juegos colaborativos.

```javascript
const pc = new RTCPeerConnection();
navigator.mediaDevices
  .getUserMedia({ video: true, audio: true })
  .then((stream) => {
    stream.getTracks().forEach((track) => pc.addTrack(track, stream));
  });
```

üí° **Uso t√≠pico:** Zoom, Google Meet, aplicaciones de streaming directo.

## 6. HTTP/2

Mejora de HTTP/1.1 con:

- Multiplexado (varias peticiones en la misma conexi√≥n).
- Compresi√≥n de cabeceras.
- Server Push (enviar recursos sin petici√≥n previa).
- Transparente para el desarrollador, pero optimiza rendimiento.

üí° **Uso t√≠pico:** sitios modernos con carga m√°s r√°pida y menos latencia.

## 7. Streaming

Transmisi√≥n de datos por partes en lugar de esperar todo el contenido.

- √ötil para manejar archivos grandes o transmitir video/audio.

```javascript
const res = await fetch("/big-data");
const reader = res.body.getReader();
```

üí° **Uso t√≠pico:** streaming de video, descargas progresivas, IA generativa en tiempo real.

## 8. Error Handling en Networking

Siempre manejar errores de red y respuestas no exitosas.

**Diferenciar entre:**

- **Errores de transporte** (red ca√≠da, DNS fallido).
- **Errores HTTP** (404, 500, etc.).

```javascript
async function safeFetch(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Error HTTP: ${res.status}`);
    return await res.json();
  } catch (err) {
    console.error("Error de red:", err);
  }
}
```

### üìå Resumen comparativo:

| Tecnolog√≠a | Direcci√≥n          | Persistencia | Caso de uso principal                    |
| ---------- | ------------------ | ------------ | ---------------------------------------- |
| XHR        | Request/Response   | No           | Soporte legacy, seguimiento de progreso  |
| Fetch API  | Request/Response   | No           | Solicitudes HTTP modernas                |
| WebSockets | Bidireccional      | S√≠           | Apps en tiempo real                      |
| SSE        | Servidor ‚Üí Cliente | S√≠           | Notificaciones y actualizaciones en vivo |
| WebRTC     | P2P                | S√≠           | Streaming multimedia y datos             |
| HTTP/2     | N/A                | N/A          | Mejor rendimiento HTTP                   |
| Streaming  | Bidireccional      | Parcial      | Transmisi√≥n progresiva de datos          |
