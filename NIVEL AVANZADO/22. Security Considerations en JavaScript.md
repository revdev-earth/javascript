# 22. Security Considerations en JavaScript/Web

La seguridad web es **defensiva**: no se trata solo de arreglar problemas cuando ocurren, sino de **prevenirlos** desde el dise√±o.

## 1. XSS Prevention (Cross-Site Scripting)

Ataque donde un atacante inyecta JS malicioso que se ejecuta en el navegador de la v√≠ctima. **Tipos:** Stored, Reflected, DOM-based.

### Prevenci√≥n:

- Escapar contenido antes de insertarlo en el DOM:

```javascript
element.textContent = userInput; // NO usar innerHTML con datos sin filtrar
```

- Usar plantillas seguras (React, Vue, Angular) que escapan por defecto.
- Configurar **CSP** (Content Security Policy) para bloquear scripts no autorizados.

## 2. CSRF Protection (Cross-Site Request Forgery)

Ataque donde el usuario autenticado realiza acciones maliciosas sin saberlo.

### Prevenci√≥n:

- Usar **tokens CSRF** √∫nicos por sesi√≥n y validar en el servidor.
- Configurar cookies con:

```http
Set-Cookie: sessionId=abc123; HttpOnly; Secure; SameSite=Strict
```

- Verificar `Origin` o `Referer` en peticiones sensibles.

## 3. CSP (Content Security Policy)

Cabecera HTTP que restringe qu√© recursos puede cargar tu p√°gina.

**Ejemplo b√°sico:**

```http
Content-Security-Policy: default-src 'self'; script-src 'self' https://apis.google.com
```

- Evita la ejecuci√≥n de scripts inline.
- Permite solo fuentes expl√≠citamente listadas.

## 4. Input Validation

Validar datos **en cliente y servidor**.

- Usar regex, tipos y rangos esperados.
- Rechazar entradas inesperadas, no solo sanitizarlas.
- Nunca confiar en que el front har√° la validaci√≥n final.

**Ejemplo:**

```javascript
function validateEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}
```

## 5. Output Encoding

Codificar datos antes de enviarlos a:

- HTML ‚Üí `&lt;`, `&gt;`, `&amp;`
- JS ‚Üí escapar comillas y caracteres especiales.
- URLs ‚Üí `encodeURIComponent()` para par√°metros din√°micos.

## 6. Secure Storage

- En **frontend**, evitar guardar tokens en `localStorage` (riesgo XSS).
- Mejor opci√≥n: **cookies HttpOnly + Secure + SameSite**.
- Cifrar datos sensibles en el backend antes de almacenarlos.
- Usar `crypto.subtle` API para cifrado/firmas cuando sea necesario:

```javascript
window.crypto.subtle.digest("SHA-256", data);
```

## 7. Authentication

- Implementar MFA (Multi-Factor Authentication) cuando sea posible.
- Evitar credenciales en c√≥digo o repositorios.
- Usar OAuth 2.0 o OpenID Connect para delegar autenticaci√≥n.
- Expirar sesiones inactivas.

## 8. Authorization

- Usar control de acceso basado en roles (RBAC) o atributos (ABAC).
- Validar permisos **en el servidor**, no solo en el cliente.
- Revisar rutas y APIs privadas para evitar accesos no autorizados.

## üìå Checklist r√°pido de seguridad:

- ‚úÖ Escapar y validar todo input/output.
- ‚úÖ Usar CSP y cookies seguras.
- ‚úÖ Implementar CSRF tokens.
- ‚úÖ Controlar autenticaci√≥n y autorizaci√≥n estrictamente.
- ‚úÖ Revisar dependencias con `npm audit` y actualizarlas.
